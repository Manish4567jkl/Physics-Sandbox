<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Explosion-Mode</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html, body {
    margin: 0; padding: 0; overflow: hidden; height: 100%;
    font-family: 'Poppins', sans-serif;
    background: #f0f5ff; /* pastel background immediately */
  }
  #loader {
    position: fixed; inset: 0;
    background: #f0f5ff;
    z-index: 100;
    display: flex;
    justify-content: center;
    align-items: center;
    visibility: visible;
    opacity: 1;
  }
  canvas.loader-canvas { width: 100%; height: 100%; display: block; }
  canvas.explosion { position: absolute; inset: 0; display: block; }
</style>
</head>
<body>

<!-- Loader -->
<div id="loader">
  <canvas class="loader-canvas"></canvas>
</div>

<!-- Main Explosion Canvas -->
<canvas class="explosion w-screen h-screen block"></canvas>

<div class="absolute top-4 right-4 z-50 max-w-xl">
  <div class="flex space-x-3 mb-3">

    <div class="p-2 transform skew-x-[-10deg] bg-rose-300 shadow-md border border-rose-400 rounded-md">
      <div class="transform skew-x-[10deg]">
        <button id="reset-button"
          class="text-xs font-bold text-gray-800 uppercase tracking-wide px-4 py-1 bg-rose-400 border border-rose-500 
                 rounded-md shadow-sm hover:bg-rose-500 transition-colors duration-150 active:scale-95">
          Reset Scene
        </button>
      </div>
    </div>

    <div class="p-2 transform skew-x-[-10deg] bg-blue-300 shadow-md border border-blue-400 rounded-md cursor-pointer select-none">
      <div class="transform skew-x-[10deg]">
        <button id="toggle-lighting"
          class="text-xs font-bold text-gray-900 uppercase tracking-wide px-4 py-1 bg-blue-400 border border-blue-500 
                 rounded-md shadow-sm hover:bg-blue-500 transition-colors duration-150 active:scale-95">
          Toggle Lighting
        </button>
      </div>
    </div>
  </div>

  <div class="p-3 transform skew-x-[-10deg] bg-rose-100 border border-rose-300 rounded-md shadow-inner text-rose-700 text-xs font-mono leading-relaxed select-none max-w-xs">
    <div class="transform skew-x-[10deg] space-y-1">
      <p><strong>Shift + Scroll</strong>: Increase explosion radius</p>
      <p><strong>Left Click</strong>: Bigger explosion</p>
      <p><strong>Right Click</strong>: Smaller explosion</p>
    </div>
  </div>
</div>

<!-- Matter.js Loader Script -->
<script type="module">
import Matter from 'https://cdn.skypack.dev/matter-js';

(() => {
  const { Engine, Render, Runner, World, Bodies, Body } = Matter;

  const canvas = document.querySelector('.loader-canvas');
  const width = window.innerWidth;
  const height = window.innerHeight;

  const engine = Engine.create();
  const world = engine.world;
  engine.gravity.y = 0;

  const render = Render.create({
    canvas: canvas,
    engine: engine,
    options: { width, height, wireframes: false, background: 'transparent' }
  });

  Render.run(render);
  Runner.run(Runner.create(), engine);

  // pastel balls for loader
  const colors = ['#FFB6C1','#A1C4FD','#FFD700','#98FB98','#FFDAC1','#E0BBE4','#D5AAFF','#B5EAD7'];
  const balls = [];

  for (let i=0;i<25;i++){
    const ball = Bodies.circle(Math.random()*width, Math.random()*height, 10+Math.random()*15, {
      restitution: 1.2, frictionAir: 0.05,
      render:{ fillStyle: colors[Math.floor(Math.random()*colors.length)] }
    });
    balls.push(ball);
  }
  World.add(world, balls);

  // walls so balls stay on screen
  const walls = [
    Bodies.rectangle(width/2, -50, width, 100, {isStatic:true}),
    Bodies.rectangle(width/2, height+50, width, 100, {isStatic:true}),
    Bodies.rectangle(-50, height/2, 100, height, {isStatic:true}),
    Bodies.rectangle(width+50, height/2, 100, height, {isStatic:true})
  ];
  World.add(world, walls);

  // fun: push all balls gently toward center periodically
  setInterval(()=>{
    balls.forEach(b=>{
      const dx = width/2 - b.position.x;
      const dy = height/2 - b.position.y;
      Body.applyForce(b, b.position, {x: dx*0.00001, y: dy*0.00001});
    });
  },100);

  // Fade out loader after 2s
  setTimeout(()=>{
    const loader = document.getElementById('loader');
    loader.style.transition = 'opacity 0.5s';
    loader.style.opacity = '0';
    setTimeout(()=>loader.remove(),500);
  },2000);
})();
</script>

<!-- Main Explosion Script -->
<script type="module" src="../modes/explosion.js"></script>

</body>
</html>
